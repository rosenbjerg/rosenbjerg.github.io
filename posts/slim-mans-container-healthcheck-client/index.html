<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>No curl, No wget, No Problem - A Bash Script for Container Healthchecks | Rosenbjerg blog</title><meta name=keywords content="docker,containers,healthcheck,shell,bash"><meta name=description content="Alright, let&rsquo;s get straight to the point: building reliable software is critical. It&rsquo;s not just a matter of nice-to-haves; it&rsquo;s about building something that stands the test of time and isn&rsquo;t prone to constant crashes. Now, this requires us to keep a diligent watch on the software&rsquo;s health. And when it comes to systems based on microservices, where there are numerous components working in tandem, this becomes even more important. Enter health checks."><meta name=author content><link rel=canonical href=https://rosenbjerg.dk/posts/slim-mans-container-healthcheck-client/><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://rosenbjerg.dk/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://rosenbjerg.dk/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://rosenbjerg.dk/favicon-32x32.png><link rel=apple-touch-icon href=https://rosenbjerg.dk/apple-touch-icon.png><link rel=mask-icon href=https://rosenbjerg.dk/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.113.0"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="No curl, No wget, No Problem - A Bash Script for Container Healthchecks"><meta property="og:description" content="Alright, let&rsquo;s get straight to the point: building reliable software is critical. It&rsquo;s not just a matter of nice-to-haves; it&rsquo;s about building something that stands the test of time and isn&rsquo;t prone to constant crashes. Now, this requires us to keep a diligent watch on the software&rsquo;s health. And when it comes to systems based on microservices, where there are numerous components working in tandem, this becomes even more important. Enter health checks."><meta property="og:type" content="article"><meta property="og:url" content="https://rosenbjerg.dk/posts/slim-mans-container-healthcheck-client/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-19T19:09:58+01:00"><meta property="article:modified_time" content="2023-05-19T19:09:58+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="No curl, No wget, No Problem - A Bash Script for Container Healthchecks"><meta name=twitter:description content="Alright, let&rsquo;s get straight to the point: building reliable software is critical. It&rsquo;s not just a matter of nice-to-haves; it&rsquo;s about building something that stands the test of time and isn&rsquo;t prone to constant crashes. Now, this requires us to keep a diligent watch on the software&rsquo;s health. And when it comes to systems based on microservices, where there are numerous components working in tandem, this becomes even more important. Enter health checks."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://rosenbjerg.dk/posts/"},{"@type":"ListItem","position":2,"name":"No curl, No wget, No Problem - A Bash Script for Container Healthchecks","item":"https://rosenbjerg.dk/posts/slim-mans-container-healthcheck-client/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"No curl, No wget, No Problem - A Bash Script for Container Healthchecks","name":"No curl, No wget, No Problem - A Bash Script for Container Healthchecks","description":"Alright, let\u0026rsquo;s get straight to the point: building reliable software is critical. It\u0026rsquo;s not just a matter of nice-to-haves; it\u0026rsquo;s about building something that stands the test of time and isn\u0026rsquo;t prone to constant crashes. Now, this requires us to keep a diligent watch on the software\u0026rsquo;s health. And when it comes to systems based on microservices, where there are numerous components working in tandem, this becomes even more important. Enter health checks.","keywords":["docker","containers","healthcheck","shell","bash"],"articleBody":"Alright, let’s get straight to the point: building reliable software is critical. It’s not just a matter of nice-to-haves; it’s about building something that stands the test of time and isn’t prone to constant crashes. Now, this requires us to keep a diligent watch on the software’s health. And when it comes to systems based on microservices, where there are numerous components working in tandem, this becomes even more important. Enter health checks.\nAmong the common ways of performing health checks, using commands like curl or wget comes to mind if you’re on a Unix-like operating system. However, with pared-down images, we may not have these tools at our disposal. So, we need something compact, portable, and effective. Well, I present to you a simple solution: a bash script to check the health of a container.\nHere’s how the script looks:\n#!/bin/bash # This script performs a basic HTTP health check on a given host and port. # It sends a simple HTTP GET request and checks for a \"200 OK\" response. # The script accepts two optional command-line arguments: # 1. The port to check (default: 8080) # 2. The host to check (default: localhost) # If the host responds with \"200 OK\", the script exits with status code 0. # If the host responds with anything else, the script exits with status code 1. port_default=8080 host_default=localhost port=${1:-$port_default} host=${2:-$host_default} exec 3\u003c\u003e/dev/tcp/${host}/${port} echo -e \"GET / HTTP/1.1\\r\\nhost: ${host}\\r\\nConnection: close\\r\\n\\r\\n\" \u003e\u00263 while IFS= read -r line do # echo \"$line\" if [[ \"$line\" =~ \"200 OK\" ]]; then echo \"HTTP 200 OK response received from ${host}\" exit 0 fi done \u003c\u00263 echo \"No HTTP 200 OK response received from ${host}\" exit 1 This nifty bash script conducts a basic HTTP health check on any specified host and port. It dispatches an HTTP GET request and awaits a “200 OK” response.\nHow to use it? Using this script is a piece of cake. During your build, just copy the script in and set the HEALTHCHECK to execute it with bash:\nFROM bitnami/nginx # ... COPY [ \"./healthcheck.sh\", \"/opt/healthcheck.sh\" ] HEALTHCHECK --interval=10s --timeout=3s --start-period=5s \\ CMD [\"bash\", \"/opt/healthcheck.sh\"] And, if you wish, you can even mount it and specify the health check in your compose file.\nThe Good Straightforward: No frills attached. Just a plain and simple script. No dependency issues as it only requires bash. A perfect fit for slim containers. Portable: It’s a bash script; it’s at home in any Unix-like system. This adds to its versatility. Customizable: It lets you adjust the host and port parameters as per your requirements. Light and efficient: It does what it’s designed for - health checking, and does it quite efficiently. The Not-So-Good Too simple: It only checks for a 200 OK response. It doesn’t interpret other response codes which could also indicate the service is functioning. Limited error handling: It’s not very adept at managing errors. It doesn’t check if the port and host are operational, or if it has connected as intended. Only TCP: This script is only suitable for the TCP protocol. Final Thoughts Yes, the script may seem basic, but hold on! It’s a worthy contender in situations where you need a lightweight, quick health check client. Want to make it more robust? Enhance its error handling, make it recognize more HTTP response codes, or even make it compatible with other protocols such as UDP. Despite its simplicity, this script perfectly embodies the beauty of practical programming in the world of container management and monitoring.\n","wordCount":"585","inLanguage":"en","datePublished":"2023-05-19T19:09:58+01:00","dateModified":"2023-05-19T19:09:58+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://rosenbjerg.dk/posts/slim-mans-container-healthcheck-client/"},"publisher":{"@type":"Organization","name":"Rosenbjerg blog","logo":{"@type":"ImageObject","url":"https://rosenbjerg.dk/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://rosenbjerg.dk/ accesskey=h title="Rosenbjerg blog (Alt + H)">Rosenbjerg blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>No curl, No wget, No Problem - A Bash Script for Container Healthchecks</h1><div class=post-meta><span title='2023-05-19 19:09:58 +0100 +0100'>May 19, 2023</span></div></header><div class=post-content><p>Alright, let&rsquo;s get straight to the point: building reliable software is critical.
It&rsquo;s not just a matter of nice-to-haves; it&rsquo;s about building something that stands the test of time and isn&rsquo;t prone to constant crashes.
Now, this requires us to keep a diligent watch on the software&rsquo;s health.
And when it comes to systems based on microservices, where there are numerous components working in tandem, this becomes even more important.
Enter health checks.</p><p>Among the common ways of performing health checks, using commands like curl or wget comes to mind if you&rsquo;re on a Unix-like operating system.
However, with pared-down images, we may not have these tools at our disposal. So, we need something compact, portable, and effective.
Well, I present to you a simple solution: a bash script to check the health of a container.</p><p>Here&rsquo;s how the script looks:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   This script performs a basic HTTP health check on a given host and port.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   It sends a simple HTTP GET request and checks for a &#34;200 OK&#34; response.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   The script accepts two optional command-line arguments:</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   1. The port to check (default: 8080)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   2. The host to check (default: localhost)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   If the host responds with &#34;200 OK&#34;, the script exits with status code 0.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   If the host responds with anything else, the script exits with status code 1.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>port_default<span style=color:#f92672>=</span><span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>host_default<span style=color:#f92672>=</span>localhost
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>port<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>1<span style=color:#66d9ef>:-</span>$port_default<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>host<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>2<span style=color:#66d9ef>:-</span>$host_default<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>exec 3&lt;&gt;/dev/tcp/<span style=color:#e6db74>${</span>host<span style=color:#e6db74>}</span>/<span style=color:#e6db74>${</span>port<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>echo -e <span style=color:#e6db74>&#34;GET / HTTP/1.1\r\nhost: </span><span style=color:#e6db74>${</span>host<span style=color:#e6db74>}</span><span style=color:#e6db74>\r\nConnection: close\r\n\r\n&#34;</span> &gt;&amp;<span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> IFS<span style=color:#f92672>=</span> read -r line
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># echo &#34;$line&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$line<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span>~ <span style=color:#e6db74>&#34;200 OK&#34;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;HTTP 200 OK response received from </span><span style=color:#e6db74>${</span>host<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        exit <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span> &lt;&amp;<span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;No HTTP 200 OK response received from </span><span style=color:#e6db74>${</span>host<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>exit <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>This nifty bash script conducts a basic HTTP health check on any specified host and port.
It dispatches an HTTP GET request and awaits a &ldquo;200 OK&rdquo; response.</p><h1 id=how-to-use-it>How to use it?<a hidden class=anchor aria-hidden=true href=#how-to-use-it>#</a></h1><p>Using this script is a piece of cake. During your build, just copy the script in and set the <code>HEALTHCHECK</code> to execute it with bash:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> bitnami/nginx</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># ...</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;./healthcheck.sh&#34;</span>, <span style=color:#e6db74>&#34;/opt/healthcheck.sh&#34;</span> <span style=color:#f92672>]</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>HEALTHCHECK --interval=10s --timeout=3s </span>--start-period<span style=color:#f92672>=</span>5s <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    CMD <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;bash&#34;</span>, <span style=color:#e6db74>&#34;/opt/healthcheck.sh&#34;</span><span style=color:#f92672>]</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p><em>And, if you wish, you can even mount it and specify the health check in your compose file.</em></p><h1 id=the-good>The Good<a hidden class=anchor aria-hidden=true href=#the-good>#</a></h1><ul><li>Straightforward: No frills attached. Just a plain and simple script. No dependency issues as it only requires bash. A perfect fit for slim containers.</li><li>Portable: It&rsquo;s a bash script; it&rsquo;s at home in any Unix-like system. This adds to its versatility.</li><li>Customizable: It lets you adjust the host and port parameters as per your requirements.</li><li>Light and efficient: It does what it&rsquo;s designed for - health checking, and does it quite efficiently.</li></ul><h1 id=the-not-so-good>The Not-So-Good<a hidden class=anchor aria-hidden=true href=#the-not-so-good>#</a></h1><ul><li>Too simple: It only checks for a 200 OK response. It doesn&rsquo;t interpret other response codes which could also indicate the service is functioning.</li><li>Limited error handling: It&rsquo;s not very adept at managing errors. It doesn&rsquo;t check if the port and host are operational, or if it has connected as intended.</li><li>Only TCP: This script is only suitable for the TCP protocol.</li></ul><h1 id=final-thoughts>Final Thoughts<a hidden class=anchor aria-hidden=true href=#final-thoughts>#</a></h1><p>Yes, the script may seem basic, but hold on! It&rsquo;s a worthy contender in situations where you need a lightweight, quick health check client.
Want to make it more robust? Enhance its error handling, make it recognize more HTTP response codes, or even make it compatible with other protocols such as UDP.
Despite its simplicity, this script perfectly embodies the beauty of practical programming in the world of container management and monitoring.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://rosenbjerg.dk/tags/docker/>docker</a></li><li><a href=https://rosenbjerg.dk/tags/containers/>containers</a></li><li><a href=https://rosenbjerg.dk/tags/healthcheck/>healthcheck</a></li><li><a href=https://rosenbjerg.dk/tags/shell/>shell</a></li><li><a href=https://rosenbjerg.dk/tags/bash/>bash</a></li></ul></footer><script src=https://utteranc.es/client.js repo=rosenbjerg/rosenbjerg.github.io issue-term=pathname label=comment theme=preferred-color-scheme crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2023 <a href=https://rosenbjerg.dk/>Rosenbjerg blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>